<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuro-Chef | Evaluaci√≥n Cognitiva HDD</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header con m√©tricas en tiempo real -->
    <header id="game-header">
        <div class="header-left">
            <a id="back-link" href="/hdd/portal/" style="color:rgba(255,255,255,0.5);text-decoration:none;font-size:0.8rem;display:flex;align-items:center;gap:4px;">‚Üê Salir</a>
            <h1>Neuro-Chef</h1>
            <p id="patient-display">Paciente: ---</p>
        </div>
        <div class="header-metrics">
            <div class="metric">
                <span class="metric-label">Nivel</span>
                <span class="metric-value" id="current-level">1/6</span>
            </div>
            <div class="metric">
                <span class="metric-label">Aciertos</span>
                <span class="metric-value" id="correct-count">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Errores</span>
                <span class="metric-value" id="error-count">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Tiempo</span>
                <span class="metric-value" id="timer-display">00:00</span>
            </div>
        </div>
    </header>

    <!-- ========== PLAYER LOGIN MODAL ========== -->
    <div id="player-login-modal" class="modal-overlay" style="display:none!important;">
        <div class="modal-content compact">
            <div class="modal-header">
                <h2>Identificaci√≥n del Jugador</h2>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">Cada jugador tiene su perfil de seguimiento</p>
            </div>
            <div class="modal-body" style="padding: 1.5rem 2rem;">
                <form id="player-login-form" autocomplete="off">
                    <div class="question-group">
                        <label for="player-dni">DNI o Identificador *</label>
                        <input type="text" id="player-dni" placeholder="Ej: 30123456" required autofocus>
                    </div>
                    <div class="question-group">
                        <label for="player-name">Nombre (opcional)</label>
                        <input type="text" id="player-name" placeholder="Ej: Juan P√©rez">
                    </div>
                    <p id="login-error-msg" class="hidden" style="color: #ff6b6b; font-size: 0.85rem; margin-top: 0.5rem;"></p>
                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.85rem; background: #D4A574; color: #1a1a1a; border: none; border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer;">Comenzar</button>
                </form>
                <div id="recent-players-section" class="hidden" style="margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                    <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-bottom: 0.5rem;">Jugadores recientes:</p>
                    <div id="recent-players" style="display: flex; flex-direction: column; gap: 0.4rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor principal del juego -->
    <main id="game-container" class="hidden">
        <div id="level-instructions" class="instructions-panel">
            <h2 id="level-title">Nivel 1: Supermercado</h2>
            <p id="level-description">Eleg√≠ los ingredientes para hacer un <strong>Pastel de Papas</strong></p>
        </div>
        <div id="game-area"></div>
        <div id="controls">
            <button id="btn-reset" class="btn-text hidden" style="color: rgba(255,255,255,0.5); background: none; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; padding: 0.6rem 1rem; border-radius: 6px; font-size: 0.85rem;">Reiniciar nivel</button>
            <button id="btn-verify" class="btn-primary">Verificar</button>
            <button id="btn-next" class="btn-secondary hidden">Siguiente Nivel</button>
        </div>
    </main>

    <!-- Modal educativo post-nivel -->
    <div id="educational-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nivel Completado</h2>
                <p id="level-score">Puntaje: <span id="score-value">0</span>/100</p>
            </div>
            <div class="modal-body" id="educational-content"></div>
            <div class="modal-footer">
                <button id="btn-continue" class="btn-primary">Continuar</button>
            </div>
        </div>
    </div>

    <!-- Modal PRE-juego -->
    <div id="pre-game-modal" class="modal-overlay hidden">
        <div class="modal-content compact" style="max-width: 420px; padding: 0; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #2c1810 0%, #1a0f0a 100%); padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 0.6rem;">
                    <div style="width: 36px; height: 36px; border-radius: 50%; background: #D4A574; display: flex; align-items: center; justify-content: center; font-size: 1.1rem;">üë®‚Äçüç≥</div>
                    <div>
                        <div style="color: #D4A574; font-weight: 600; font-size: 0.95rem;">Chef</div>
                        <div style="color: #888; font-size: 0.7rem;">en l√≠nea</div>
                    </div>
                </div>
                <button id="btn-skip-pre" style="color: #888; background: none; border: 1px solid #444; border-radius: 6px; padding: 0.3rem 0.8rem; cursor: pointer; font-size: 0.75rem; transition: all 0.2s;">Saltar ‚è≠</button>
            </div>
            <div id="chat-messages" style="height: 280px; overflow-y: auto; padding: 1rem 1.2rem; display: flex; flex-direction: column; gap: 0.6rem; background: #0d0d0d;">
            </div>
            <div id="chat-input-area" style="padding: 0.8rem 1rem; background: #1a1a1a; border-top: 1px solid #333; display: flex; gap: 0.5rem; align-items: center;">
                <input type="text" id="chat-input" placeholder="Escrib√≠ ac√°..." style="flex: 1; background: #2a2a2a; border: 1px solid #444; border-radius: 20px; padding: 0.6rem 1rem; color: #eee; font-size: 0.9rem; outline: none;" autocomplete="off">
                <button id="chat-send" style="width: 36px; height: 36px; border-radius: 50%; background: #D4A574; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; transition: transform 0.15s;">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Modal POST-juego (selector de color) -->
    <div id="post-game-modal" class="modal-overlay hidden">
        <div class="modal-content compact">
            <div class="modal-header"><h2>Seg√∫n tu partida, eleg√≠ un color</h2></div>
            <div class="modal-body">
                <div id="color-selector" class="color-selector">
                    <div class="color-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; justify-items: center; padding: 8px 0;"></div>
                    <p style="text-align:center;color:rgba(255,255,255,0.35);font-size:0.8rem;margin-top:12px;">No hay respuestas correctas ni incorrectas</p>
                </div>
            </div>
            <div class="modal-footer" style="display: flex !important; justify-content: space-between; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <button id="btn-skip-post" class="btn-text" style="color: rgba(255,255,255,0.6); background: none; border: none; cursor: pointer; font-size: 0.9rem;">Omitir</button>
                <button id="btn-continue-post" class="btn-primary" disabled style="padding: 0.75rem 1.5rem; opacity: 0.5; background: #D4A574; color: #1a1a1a; border: none; border-radius: 8px; font-weight: 600;">Listo</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/educational-tips.js"></script>
    <script src="js/biometrics.js"></script>
    <script src="js/game.js"></script>
    <script>
    // Smart back link: detect partner vs portal origin
    (function(){var portalUrl=localStorage.getItem('games_session')?'/games/portal/':'/hdd/portal/';var l=document.getElementById('back-link');if(l)l.href=portalUrl;})();
    </script>
    <!-- Mood modals v4 -->
    <script src="/games/shared/mood-modals.js"></script>
    <script>if (typeof initMoodModals === 'function') initMoodModals();</script>
</body>
</html>
