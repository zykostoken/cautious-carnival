[build]
  publish = "."
  command = "npm run build"
  environment = { SECRETS_SCAN_SMART_DETECTION_ENABLED = "false" }

[functions]
  directory = "netlify/functions"

# =============================================
# CACHE HEADERS FOR STATIC ASSETS
# =============================================

# Cache CSS and JS files for 1 year (they are versioned by content)
[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache images for 1 week
[[headers]]
  for = "/hdd/img/*"
  [headers.values]
    Cache-Control = "public, max-age=604800"

# HTML pages - short cache with revalidation
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=300, must-revalidate"

# API routes
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# HDD Public page
[[redirects]]
  from = "/hdd"
  to = "/hdd/index.html"
  status = 200

# HDDD - Hospital de Dia Digital (standalone portal)
[[redirects]]
  from = "/HDDD"
  to = "/HDDD/index.html"
  status = 200

[[redirects]]
  from = "/hddd"
  to = "/HDDD/index.html"
  status = 200

# HDD Patient Portal
[[redirects]]
  from = "/hdd/portal"
  to = "/hdd/portal/index.html"
  status = 200

[[redirects]]
  from = "/hdd/portal/"
  to = "/hdd/portal/index.html"
  status = 200

# HDD Games
[[redirects]]
  from = "/hdd/portal/games/*"
  to = "/hdd/portal/games/:splat"
  status = 200

[[redirects]]
  from = "/hdd/*"
  to = "/hdd/:splat"
  status = 200

# =============================================
# EXTERNAL GAMES PORTAL (separate from HDD)
# =============================================

# Games Login/Landing
[[redirects]]
  from = "/games"
  to = "/games/index.html"
  status = 200

# Games Portal (after auth)
[[redirects]]
  from = "/games/portal"
  to = "/games/portal/index.html"
  status = 200

# Individual Games
[[redirects]]
  from = "/games/play/*"
  to = "/games/play/:splat"
  status = 200

[[redirects]]
  from = "/games/*"
  to = "/games/:splat"
  status = 200

# Main SPA fallback
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
