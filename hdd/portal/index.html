<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hospital de DÃ­a - ClÃ­nica JosÃ© Ingenieros</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/css/hdd-portal.css">
</head>
<body>
  <!-- Login View -->
  <div id="login-view" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 1.75rem; margin: 0 auto 1rem;">HdD</div>
        <h1>Hospital de DÃ­a</h1>
        <p>ClÃ­nica PsiquiÃ¡trica JosÃ© Ingenieros</p>
      </div>

      <!-- Login Form -->
      <form id="login-form">
        <div class="form-group">
          <label for="dni">DNI</label>
          <input type="text" id="dni" name="dni" placeholder="Ingrese su DNI" required>
        </div>

        <div class="form-group">
          <label for="password">ContraseÃ±a</label>
          <input type="password" id="password" name="password" placeholder="Ingrese su contraseÃ±a" required>
          <p class="form-hint">Si es su primer inicio de sesiÃ³n, esta serÃ¡ su nueva contraseÃ±a.</p>
        </div>

        <div id="login-error" class="form-error hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.75rem;">
          Iniciar SesiÃ³n
        </button>
      </form>

      <div style="margin-top: 1.5rem; text-align: center; border-top: 1px solid var(--border); padding-top: 1.5rem;">
        <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;">Â¿Primera vez aquÃ­?</p>
        <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showRegisterForm()">
          Registrarse
        </button>
      </div>

      <div style="margin-top: 1.5rem; text-align: center;">
        <a href="/hdd" class="back-link">â† Volver a Hospital de DÃ­a</a>
      </div>
    </div>
  </div>

  <!-- Register View -->
  <div id="register-view" class="login-container hidden">
    <div class="login-card">
      <div class="login-header">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 1.75rem; margin: 0 auto 1rem;">HdD</div>
        <h1>Registrarse</h1>
        <p>Hospital de DÃ­a</p>
      </div>

      <div class="alert alert-info" style="background: #e0f2fe; color: #0369a1; margin-bottom: 1rem;">
        Solo pueden registrarse pacientes autorizados por la clÃ­nica.
      </div>

      <form id="register-form">
        <div class="form-group">
          <label for="reg-dni">DNI *</label>
          <input type="text" id="reg-dni" placeholder="Ej: 12345678" required>
          <p class="form-hint">IngresÃ¡ tu DNI sin puntos</p>
        </div>

        <div class="form-group">
          <label for="reg-fullname">Nombre Completo *</label>
          <input type="text" id="reg-fullname" placeholder="Nombre y apellido" required>
        </div>

        <div class="form-group">
          <label for="reg-email">Email *</label>
          <input type="email" id="reg-email" placeholder="tu@email.com" required>
        </div>

        <div class="form-group">
          <label for="reg-password">ContraseÃ±a *</label>
          <input type="password" id="reg-password" placeholder="MÃ­nimo 6 caracteres" required>
        </div>

        <div id="register-error" class="form-error hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.75rem;">
          Registrarse
        </button>
      </form>

      <div style="margin-top: 1.5rem; text-align: center;">
        <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="showLoginForm()">
          â† Ya tengo cuenta
        </button>
      </div>
    </div>
  </div>

  <!-- Main App View -->
  <div id="app-view" class="hidden">
    <header class="header">
      <div class="header-content">
        <a href="/hdd/portal" class="logo">
          <div class="logo-icon">HdD</div>
          <div>
            <div class="logo-text">Hospital de DÃ­a</div>
            <div class="logo-subtitle">Comunidad</div>
          </div>
        </a>

        <div class="user-menu">
          <span class="user-name" id="user-name"></span>
          <button class="btn btn-secondary" onclick="showProfileModal()">Perfil</button>
          <button class="btn btn-secondary" onclick="logout()">Salir</button>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="feed" onclick="switchTab('feed')">Comunidad</button>
        <button class="nav-tab" data-tab="games" onclick="switchTab('games')">Juegos</button>
        <button class="nav-tab" data-tab="activities" onclick="switchTab('activities')">Actividades</button>
        <button class="nav-tab" data-tab="my-posts" onclick="switchTab('my-posts')">Mis Publicaciones</button>
        <button class="nav-tab" data-tab="metrics" onclick="switchTab('metrics')">ğŸ“Š MÃ©tricas</button>
      </div>

      <!-- Feed Tab -->
      <div id="tab-feed" class="feed-container">
        <div class="create-post">
          <textarea id="new-post-content" placeholder="Â¿QuÃ© quieres compartir hoy?"></textarea>
          <div class="create-post-actions">
            <div class="post-options">
              <button class="post-option" onclick="document.getElementById('image-upload').click()" title="Agregar imagen">
                ğŸ“·
              </button>
              <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
            </div>
            <button class="btn btn-primary" onclick="createPost()">Publicar</button>
          </div>
          <div id="image-preview" class="hidden" style="margin-top: 0.5rem;">
            <img id="preview-img" style="max-height: 150px; border-radius: 8px;">
            <button class="btn btn-secondary" onclick="clearImagePreview()" style="margin-left: 0.5rem;">âœ•</button>
          </div>
        </div>

        <div id="feed-posts">
          <div class="loading">Cargando publicaciones...</div>
        </div>
      </div>

      <!-- Games Tab -->
      <div id="tab-games" class="feed-container hidden">
        <h2 style="margin-bottom: 1rem;">Juegos TerapÃ©uticos</h2>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Ejercicios lÃºdicos para trabajar habilidades cognitivas y motoras.</p>

        <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
          <!-- Game 1: Lawn Mower -->
          <div class="activity-card" style="cursor: pointer;" onclick="openGame('lawn-mower')">
            <div class="activity-icon" style="font-size: 2rem;">ğŸŒ¿</div>
            <div class="activity-info">
              <div class="activity-name">Cortadora de CÃ©sped</div>
              <div class="activity-schedule">Motricidad fina, planificaciÃ³n, atenciÃ³n</div>
            </div>
            <span style="color: var(--primary);">Jugar â†’</span>
          </div>

          <!-- Game 2: Memory Prescriptions -->
          <div class="activity-card" style="cursor: pointer;" onclick="openGame('memory-meds')">
            <div class="activity-icon" style="font-size: 2rem;">ğŸ’Š</div>
            <div class="activity-info">
              <div class="activity-name">Memoria de Medicamentos</div>
              <div class="activity-schedule">Memoria, atenciÃ³n, seguimiento de instrucciones</div>
            </div>
            <span style="color: var(--primary);">Jugar â†’</span>
          </div>

          <!-- Game 3: Pill Organizer -->
          <div class="activity-card" style="cursor: pointer;" onclick="launchGame('pill-organizer')">
            <div class="activity-icon" style="font-size: 2rem;">ğŸ’Š</div>
            <div class="activity-info">
              <div class="activity-name">Organizador de MedicaciÃ³n</div>
              <div class="activity-schedule">Motricidad fina, organizaciÃ³n cognitiva</div>
            </div>
            <span style="color: var(--primary);">Jugar â†’</span>
          </div>

          <!-- Game 4: Neuro-Chef -->
          <div class="activity-card" style="cursor: pointer;" onclick="launchGame('neuro-chef')">
            <div class="activity-icon" style="font-size: 2rem;">ğŸ½ï¸</div>
            <div class="activity-info">
              <div class="activity-name">Neuro-Chef: La Mesa Puesta</div>
              <div class="activity-schedule">PlanificaciÃ³n motora, memoria procedimental</div>
            </div>
            <span style="color: var(--primary);">Jugar â†’</span>
          </div>
        </div>

        <!-- Game Container (for inline games if needed) -->
        <div id="game-container" class="hidden" style="margin-top: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 id="game-title"></h3>
            <button class="btn btn-secondary" onclick="closeGame()">Cerrar juego</button>
          </div>
          <div id="game-area" style="background: var(--surface); border-radius: 12px; border: 1px solid var(--border); overflow: hidden;"></div>
        </div>

      </div>
    </div>

    <!-- Activities Tab -->
      <div id="tab-activities" class="feed-container hidden">
        <h2 style="margin-bottom: 1rem;">Actividades Semanales</h2>
        <div id="activities-list">
          <div class="loading">Cargando actividades...</div>
        </div>

        <div style="margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem;">Galeria de Productos</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
            <img src="/hdd/img/kits-verduras.jpg" alt="Kits de Verduras" style="width: 100%; border-radius: 8px;">
            <img src="/hdd/img/flores-papel.jpg" alt="Flores de Papel" style="width: 100%; border-radius: 8px;">
            <img src="/hdd/img/masa-tortas.jpg" alt="Masa para Tortas" style="width: 100%; border-radius: 8px;">
            <img src="/hdd/img/ensalada-frutas.jpg" alt="Ensalada de Frutas" style="width: 100%; border-radius: 8px;">
          </div>
        </div>

        <!-- Resources Section -->
        <div style="margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem;">Recursos y Material de Apoyo</h3>
          <div id="portal-resources-list">
            <div class="loading">Cargando recursos...</div>
          </div>
        </div>
      </div>

      <!-- My Posts Tab -->
      <div id="tab-my-posts" class="feed-container hidden">
        <h2 style="margin-bottom: 1rem;">Mis Publicaciones</h2>
        <div id="my-posts-list">
          <div class="loading">Cargando...</div>
        </div>
      </div>
    
      <!-- Metrics Tab -->
      <div id="tab-metrics" class="hidden">
        <iframe src="/hdd/portal/metrics.html" style="width: 100%; height: 800px; border: none; border-radius: 12px;"></iframe>
      </div>

    </main>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal" class="modal-overlay hidden" onclick="closeModal(event, 'profile-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Mi Perfil</h3>
        <button class="modal-close" onclick="hideProfileModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="profile-form">
          <div class="form-group">
            <label>DNI</label>
            <input type="text" id="profile-dni" disabled>
          </div>
          <div class="form-group">
            <label for="profile-email">Email</label>
            <input type="email" id="profile-email" placeholder="tu@email.com">
          </div>
          <div class="form-group">
            <label for="profile-phone">TelÃ©fono</label>
            <input type="tel" id="profile-phone" placeholder="+54 11 1234-5678">
          </div>
        </form>

        <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border);">

        <h4 style="margin-bottom: 1rem;">Cambiar ContraseÃ±a</h4>
        <form id="password-form">
          <div class="form-group">
            <label for="current-password">ContraseÃ±a Actual</label>
            <input type="password" id="current-password">
          </div>
          <div class="form-group">
            <label for="new-password">Nueva ContraseÃ±a</label>
            <input type="password" id="new-password">
          </div>
          <button type="submit" class="btn btn-secondary" style="width: 100%;">Cambiar ContraseÃ±a</button>
        </form>

        <div id="profile-message" class="hidden" style="margin-top: 1rem;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideProfileModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveProfile()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Comments Modal -->
  <div id="comments-modal" class="modal-overlay hidden" onclick="closeModal(event, 'comments-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Comentarios</h3>
        <button class="modal-close" onclick="hideCommentsModal()">&times;</button>
      </div>
      <div class="modal-body" id="comments-modal-content">
        <div class="loading">Cargando comentarios...</div>
      </div>
    </div>
  </div>

  <!-- Daily Mood Check-in Modal -->
  <div id="mood-checkin-modal" class="modal-overlay hidden" onclick="event.stopPropagation()">
    <div class="modal" onclick="event.stopPropagation()" style="max-width: 540px;">
      <div class="modal-header">
        <h3>Chequeo Diario de Bienestar</h3>
        <button class="modal-close" onclick="skipMoodCheckin()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mood-checkin-container">
          <!-- Wellness reference guide -->
          <div id="wellness-reference" style="background: linear-gradient(135deg, #e0f2fe 0%, #f0fdf4 100%); border-radius: 12px; padding: 1rem; margin-bottom: 1.25rem; border: 1px solid #bae6fd;">
            <p style="font-weight: 600; font-size: 0.95rem; color: #0369a1; margin-bottom: 0.5rem;">Referencia de Bienestar Diario</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.4rem; font-size: 0.82rem;">
              <div style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">ğŸ˜¢</span> <span style="color: #991b1b; font-weight: 500;">Muy mal</span> <span style="color: #64748b;">- Crisis / mucha angustia</span></div>
              <div style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">ğŸ˜”</span> <span style="color: #9a3412; font-weight: 500;">Mal</span> <span style="color: #64748b;">- Triste / ansioso</span></div>
              <div style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">ğŸ˜</span> <span style="color: #854d0e; font-weight: 500;">Regular</span> <span style="color: #64748b;">- Ni bien ni mal</span></div>
              <div style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">ğŸ™‚</span> <span style="color: #166534; font-weight: 500;">Bien</span> <span style="color: #64748b;">- Tranquilo / contento</span></div>
              <div style="display: flex; align-items: center; gap: 0.4rem; grid-column: 1 / -1; justify-content: center;"><span style="font-size: 1.2rem;">ğŸ˜Š</span> <span style="color: #15803d; font-weight: 500;">Muy bien</span> <span style="color: #64748b;">- Entusiasmado / pleno</span></div>
            </div>
          </div>

          <p class="mood-question">Hola! Como empezaste tu dia hoy? Como te sentis?</p>

          <div class="mood-options" id="mood-options">
            <div class="mood-option" data-value="1" onclick="selectMood(1)">
              <span class="mood-emoji">ğŸ˜¢</span>
              <span class="mood-label">Muy mal</span>
            </div>
            <div class="mood-option" data-value="2" onclick="selectMood(2)">
              <span class="mood-emoji">ğŸ˜”</span>
              <span class="mood-label">Mal</span>
            </div>
            <div class="mood-option" data-value="3" onclick="selectMood(3)">
              <span class="mood-emoji">ğŸ˜</span>
              <span class="mood-label">Regular</span>
            </div>
            <div class="mood-option" data-value="4" onclick="selectMood(4)">
              <span class="mood-emoji">ğŸ™‚</span>
              <span class="mood-label">Bien</span>
            </div>
            <div class="mood-option" data-value="5" onclick="selectMood(5)">
              <span class="mood-emoji">ğŸ˜Š</span>
              <span class="mood-label">Muy bien</span>
            </div>
          </div>

          <!-- Color Palette Selection -->
          <div class="color-palette-section" style="margin-top: 1.25rem;">
            <p style="font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">Elegi un color que represente como te sentis:</p>

            <!-- Intensity Selector with color preview swatches -->
            <div class="color-intensity-selector" style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
              <button type="button" class="intensity-btn active" onclick="setColorIntensity('vivid')" data-intensity="vivid" style="padding: 0.35rem 0.85rem; border-radius: 20px; border: 2px solid var(--primary); background: var(--primary); color: #fff; font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem;">
                <span style="display: inline-flex; gap: 2px;"><span style="width: 10px; height: 10px; border-radius: 50%; background: #FF0000;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #00FF00;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #0000FF;"></span></span>
                Vivos
              </button>
              <button type="button" class="intensity-btn" onclick="setColorIntensity('soft')" data-intensity="soft" style="padding: 0.35rem 0.85rem; border-radius: 20px; border: 2px solid var(--border); background: var(--surface); color: var(--text); font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem;">
                <span style="display: inline-flex; gap: 2px;"><span style="width: 10px; height: 10px; border-radius: 50%; background: #F08080;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #98FB98;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #87CEEB;"></span></span>
                Suaves
              </button>
              <button type="button" class="intensity-btn" onclick="setColorIntensity('pastel')" data-intensity="pastel" style="padding: 0.35rem 0.85rem; border-radius: 20px; border: 2px solid var(--border); background: var(--surface); color: var(--text); font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem;">
                <span style="display: inline-flex; gap: 2px;"><span style="width: 10px; height: 10px; border-radius: 50%; background: #FFD1DC;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #C1E1C1;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #C1D4E0;"></span></span>
                Pastel
              </button>
              <button type="button" class="intensity-btn" onclick="setColorIntensity('dark')" data-intensity="dark" style="padding: 0.35rem 0.85rem; border-radius: 20px; border: 2px solid var(--border); background: var(--surface); color: var(--text); font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem;">
                <span style="display: inline-flex; gap: 2px;"><span style="width: 10px; height: 10px; border-radius: 50%; background: #8B0000;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #006400;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #191970;"></span></span>
                Oscuros
              </button>
              <button type="button" class="intensity-btn" onclick="setColorIntensity('muted')" data-intensity="muted" style="padding: 0.35rem 0.85rem; border-radius: 20px; border: 2px solid var(--border); background: var(--surface); color: var(--text); font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem;">
                <span style="display: inline-flex; gap: 2px;"><span style="width: 10px; height: 10px; border-radius: 50%; background: #BC8F8F;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #8FBC8F;"></span><span style="width: 10px; height: 10px; border-radius: 50%; background: #708090;"></span></span>
                Apagados
              </button>
            </div>

            <!-- Color Grid -->
            <div id="color-palette-grid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px; min-height: 90px;">
              <!-- Colors rendered by JS based on intensity -->
            </div>

            <div id="selected-color-preview" style="display: none; margin-top: 0.5rem; padding: 0.4rem 0.75rem; border-radius: 8px; text-align: center; font-size: 0.85rem; color: #fff;">
              Color seleccionado
            </div>
          </div>

          <div class="mood-note-section">
            <label for="mood-note">Queres agregar algo mas? (opcional)</label>
            <textarea id="mood-note" placeholder="Como dormiste? Tenes alguna preocupacion? Algo que quieras compartir..."></textarea>
          </div>

          <span class="mood-skip" onclick="skipMoodCheckin()">Omitir por ahora</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" style="font-size: 0.85rem;" onclick="toggleWellnessReference()">Ver referencia</button>
        <button class="btn btn-primary" id="submit-mood-btn" onclick="submitMoodCheckin()" disabled>Guardar mi estado</button>
      </div>
    </div>
  </div>

  <script src="/js/hdd-portal.js" defer></script>
</body>
</html>
