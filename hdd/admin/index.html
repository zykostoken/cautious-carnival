<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administracion - Hospital de Dia</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/css/hdd-admin.css">
</head>
<body>
  <!-- Login View -->
  <div id="login-view" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="logo-icon">HdD</div>
        <h1>Panel de Administracion</h1>
        <p>Hospital de Dia - Acceso para Profesionales</p>
      </div>

      <div class="alert alert-info" style="margin-bottom: 1.5rem;">
        Acceso exclusivo para profesionales autorizados del Hospital de Dia.
      </div>

      <!-- Login Form -->
      <form id="login-form">
        <div class="form-group">
          <label for="email">Email institucional</label>
          <input type="email" id="email" placeholder="usuario@clinicajoseingenieros.ar" required>
        </div>

        <div class="form-group">
          <label for="password">Contrasena</label>
          <input type="password" id="password" placeholder="Ingrese su contrasena" required>
        </div>

        <div id="login-error" class="form-error hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.85rem;">
          Ingresar al Panel
        </button>
      </form>

      <!-- Setup Password Form (for pre-seeded professionals) -->
      <form id="setup-form" class="hidden">
        <div class="alert alert-info" style="margin-bottom: 1rem;">
          <strong>Primera vez?</strong> Configure su contrasena para acceder al sistema.
        </div>

        <div class="form-group">
          <label for="setup-email">Email institucional</label>
          <input type="email" id="setup-email" placeholder="usuario@clinicajoseingenieros.ar" required>
        </div>

        <div class="form-group">
          <label for="setup-name">Nombre completo</label>
          <input type="text" id="setup-name" placeholder="Su nombre completo" required>
        </div>

        <div class="form-group">
          <label for="setup-password">Nueva contrasena</label>
          <input type="password" id="setup-password" placeholder="Minimo 6 caracteres" required minlength="6">
        </div>

        <div class="form-group">
          <label for="setup-password-confirm">Confirmar contrasena</label>
          <input type="password" id="setup-password-confirm" placeholder="Repita la contrasena" required minlength="6">
        </div>

        <div id="setup-error" class="form-error hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.85rem;">
          Configurar y Acceder
        </button>
      </form>

      <!-- Forgot Password Form -->
      <form id="forgot-form" class="hidden">
        <div class="alert alert-info" style="margin-bottom: 1rem;">
          Ingrese su email institucional para recibir un codigo de recuperacion.
        </div>

        <div class="form-group">
          <label for="forgot-email">Email institucional</label>
          <input type="email" id="forgot-email" placeholder="usuario@clinicajoseingenieros.ar" required>
        </div>

        <div id="forgot-error" class="form-error hidden"></div>
        <div id="forgot-success" class="alert alert-success hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.85rem;">
          Enviar Codigo
        </button>
      </form>

      <!-- Reset Password Form -->
      <form id="reset-form" class="hidden">
        <div class="alert alert-info" style="margin-bottom: 1rem;">
          Ingrese el codigo de 6 digitos que recibio en su email.
        </div>

        <div class="form-group">
          <label for="reset-email">Email institucional</label>
          <input type="email" id="reset-email" required>
        </div>

        <div class="form-group">
          <label for="reset-code">Codigo de recuperacion</label>
          <input type="text" id="reset-code" placeholder="123456" required maxlength="6" pattern="[0-9]{6}">
        </div>

        <div class="form-group">
          <label for="reset-password">Nueva contrasena</label>
          <input type="password" id="reset-password" placeholder="Minimo 6 caracteres" required minlength="6">
        </div>

        <div id="reset-error" class="form-error hidden"></div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 0.85rem;">
          Restablecer Contrasena
        </button>
      </form>

      <div style="margin-top: 1.5rem; text-align: center; display: flex; flex-direction: column; gap: 0.75rem;">
        <div id="login-links">
          <a href="#" onclick="showSetupForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Primera vez? Configurar contrasena</a>
          <span style="color: var(--text-muted); margin: 0 0.5rem;">|</span>
          <a href="#" onclick="showForgotForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Olvide mi contrasena</a>
        </div>
        <div id="setup-links" class="hidden">
          <a href="#" onclick="showLoginForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Ya tengo contrasena, iniciar sesion</a>
        </div>
        <div id="forgot-links" class="hidden">
          <a href="#" onclick="showLoginForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Volver al inicio de sesion</a>
          <span style="color: var(--text-muted); margin: 0 0.5rem;">|</span>
          <a href="#" onclick="showResetForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Ya tengo un codigo</a>
        </div>
        <div id="reset-links" class="hidden">
          <a href="#" onclick="showLoginForm(); return false;" style="color: var(--primary); font-size: 0.9rem;">Volver al inicio de sesion</a>
        </div>
        <a href="/hdd" style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.5rem;">Volver al Hospital de Dia</a>
      </div>
    </div>
  </div>

  <!-- Main App View -->
  <div id="app-view" class="hidden">
    <header class="header">
      <div class="header-content">
        <a href="/hdd/admin" class="logo">
          <div class="logo-icon">HdD</div>
          <div>
            <div class="logo-text">Panel de Administracion</div>
            <div class="logo-subtitle">Hospital de Dia</div>
          </div>
        </a>

        <div class="user-info">
          <span class="user-role" id="user-role">Admin</span>
          <span class="user-email" id="user-email"></span>
          <a href="/hdd/portal?preview=true" class="btn btn-ghost btn-sm" target="_blank">Ver Portal Pacientes</a>
          <button class="btn btn-ghost btn-sm" onclick="logout()">Cerrar Sesion</button>
        </div>
      </div>
    </header>

    <main class="main-container">
      <!-- Stats -->
      <div class="stats-grid" id="stats-container">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-value" id="stat-active">-</div>
          <div class="stat-label">Pacientes Activos</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-value" id="stat-logged">-</div>
          <div class="stat-label">Han Ingresado</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìù</div>
          <div class="stat-value" id="stat-posts">-</div>
          <div class="stat-label">Publicaciones</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üè•</div>
          <div class="stat-value" id="stat-discharged">-</div>
          <div class="stat-label">Dados de Alta</div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="patients" onclick="switchTab('patients')">Pacientes</button>
        <button class="tab" data-tab="games" onclick="switchTab('games')">Juegos</button>
        <button class="tab" data-tab="metrics" onclick="switchTab('metrics')">Metricas</button>
        <button class="tab" data-tab="rooms" onclick="switchTab('rooms')">Salas Grupales</button>
        <button class="tab" data-tab="resources" onclick="switchTab('resources')">Recursos</button>
        <button class="tab" data-tab="activities" onclick="switchTab('activities')">Actividades</button>
        <button class="tab" data-tab="reports" onclick="switchTab('reports')">Reportes</button>
      </div>

      <!-- Patients Tab -->
      <div id="tab-patients">
        <div class="card">
          <div class="card-header">
            <h2>Gestion de Pacientes</h2>
            <button class="btn btn-primary" onclick="showAddPatientModal()">+ Agregar Paciente</button>
          </div>
          <div class="card-body">
            <div class="search-box">
              <input type="text" class="search-input" id="patient-search" placeholder="Buscar por nombre o DNI..." oninput="filterPatients()">
              <select class="filter-select" id="status-filter" onchange="filterPatients()">
                <option value="active">Activos</option>
                <option value="discharged">Dados de Alta</option>
                <option value="all">Todos</option>
              </select>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Paciente</th>
                    <th>DNI</th>
                    <th>Ingreso</th>
                    <th>Estado</th>
                    <th>Sesion</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="patients-table">
                  <tr><td colspan="6" class="empty-state">Cargando pacientes...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Games Tab -->
      <div id="tab-games" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Juegos Terapeuticos</h2>
            <span class="badge-info">Modo de prueba para profesionales</span>
          </div>
          <div class="card-body">
            <div class="alert alert-info" style="margin-bottom: 1.5rem;">
              Desde aqui puede probar los juegos terapeuticos para conocer la experiencia de los pacientes y evaluar su utilidad clinica.
            </div>

            <div class="games-grid" id="games-list">
              <!-- Lawn Mower Game -->
              <div class="game-card">
                <div class="game-icon">üöú</div>
                <h3>Cortadora de Cesped</h3>
                <p class="game-desc">Juego de planificacion y atencion. El paciente debe cortar todo el cesped evitando obstaculos.</p>
                <div class="game-skills">
                  <span class="skill-tag">Motricidad fina</span>
                  <span class="skill-tag">Planificacion</span>
                  <span class="skill-tag">Atencion</span>
                  <span class="skill-tag">Control de impulsos</span>
                </div>
                <div class="game-actions">
                  <a href="/hdd/portal/games/lawn-mower.html?demo=true" target="_blank" class="btn btn-primary">Probar Juego</a>
                  <button class="btn btn-secondary" onclick="showGameStats('lawn-mower')">Ver Estadisticas</button>
                </div>
              </div>

              <!-- Medication Memory Game -->
              <div class="game-card">
                <div class="game-icon">üíä</div>
                <h3>Memoria de Medicacion</h3>
                <p class="game-desc">Juego de memoria de trabajo. El paciente debe memorizar y armar recetas medicas correctamente.</p>
                <div class="game-skills">
                  <span class="skill-tag">Memoria de trabajo</span>
                  <span class="skill-tag">Atencion al detalle</span>
                  <span class="skill-tag">Comprension lectora</span>
                  <span class="skill-tag">Responsabilidad</span>
                </div>
                <div class="game-actions">
                  <a href="/hdd/portal/games/medication-memory.html?demo=true" target="_blank" class="btn btn-primary">Probar Juego</a>
                  <button class="btn btn-secondary" onclick="showGameStats('medication-memory')">Ver Estadisticas</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Game Statistics Modal -->
        <div id="game-stats-section" class="card hidden" style="margin-top: 1.5rem;">
          <div class="card-header">
            <h2 id="game-stats-title">Estadisticas del Juego</h2>
            <button class="btn btn-secondary btn-sm" onclick="hideGameStats()">Cerrar</button>
          </div>
          <div class="card-body" id="game-stats-content">
            <!-- Stats loaded dynamically -->
          </div>
        </div>
      </div>

      <!-- Metrics Tab - Comprehensive Clinical Dashboard -->
      <div id="tab-metrics" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Dashboard Clinico Interactivo</h2>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
              <select class="filter-select" id="metrics-date-range" onchange="loadPatientMetrics()" style="min-width: 140px;">
                <option value="7">Ultimos 7 dias</option>
                <option value="30" selected>Ultimo mes</option>
                <option value="90">Ultimos 3 meses</option>
                <option value="180">Ultimos 6 meses</option>
                <option value="365">Ultimo ano</option>
                <option value="all">Todo el historial</option>
              </select>
              <button class="btn btn-secondary btn-sm" onclick="exportPatientReport()" id="export-report-btn" style="display:none;">Exportar Reporte</button>
            </div>
          </div>
          <div class="card-body">
            <div class="alert alert-info" style="margin-bottom: 1.5rem;">
              Panel de seguimiento longitudinal. Seleccione un paciente para ver metricas clinicas, estados de animo, seleccion de colores, biomarcadores de juegos y actividad en el portal.
            </div>

            <div class="search-box">
              <select class="filter-select" id="metrics-patient-select" style="flex: 1; min-width: 250px;" onchange="loadPatientMetrics()">
                <option value="">-- Seleccionar paciente --</option>
              </select>
            </div>

            <div id="patient-metrics-content" class="hidden">
              <!-- Summary Cards -->
              <div class="metrics-summary" id="metrics-summary" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem;">
                <div class="stat-card">
                  <div class="stat-icon">üìÖ</div>
                  <div class="stat-value" id="metric-logins">-</div>
                  <div class="stat-label">Total Logins</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">üéÆ</div>
                  <div class="stat-value" id="metric-games">-</div>
                  <div class="stat-label">Sesiones Juego</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">üìù</div>
                  <div class="stat-value" id="metric-posts">-</div>
                  <div class="stat-label">Publicaciones</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">‚è±Ô∏è</div>
                  <div class="stat-value" id="metric-time">-</div>
                  <div class="stat-label">Tiempo Juego</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">üòä</div>
                  <div class="stat-value" id="metric-avg-mood">-</div>
                  <div class="stat-label">Animo Promedio</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">üé®</div>
                  <div class="stat-value" id="metric-color-count">-</div>
                  <div class="stat-label">Registros Color</div>
                </div>
              </div>

              <!-- Mood Timeline Chart -->
              <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 0.75rem;">Evolucion del Estado de Animo</h3>
                <div id="mood-chart-container" style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem; min-height: 200px;">
                  <canvas id="moodChart" width="800" height="200"></canvas>
                </div>
              </div>

              <!-- Color Selection History -->
              <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 0.75rem;">Historial de Seleccion de Colores</h3>
                <div id="color-history-container" style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem;">
                  <div id="color-timeline" style="display: flex; flex-wrap: wrap; gap: 4px; min-height: 60px;">
                    <!-- Color swatches rendered dynamically -->
                  </div>
                  <div id="color-distribution" style="margin-top: 1rem;">
                    <!-- Color frequency distribution -->
                  </div>
                </div>
              </div>

              <!-- Game Performance Charts -->
              <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 0.75rem;">Rendimiento en Juegos</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                  <div style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem;">
                    <h4 style="margin-bottom: 0.5rem; font-size: 0.9rem;">Puntuacion por Sesion</h4>
                    <canvas id="scoreChart" width="400" height="180"></canvas>
                  </div>
                  <div style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem;">
                    <h4 style="margin-bottom: 0.5rem; font-size: 0.9rem;">Tiempo de Reaccion / Duracion</h4>
                    <canvas id="timeChart" width="400" height="180"></canvas>
                  </div>
                </div>
              </div>

              <!-- Biomarcadores / Game Metrics -->
              <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 0.75rem;">Biomarcadores de Juego</h3>
                <div id="biomarkers-container" style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem;">
                  <div id="biomarkers-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem;">
                    <!-- Biomarker cards rendered dynamically -->
                  </div>
                </div>
              </div>

              <!-- Game Progress Table -->
              <h3 style="margin: 1.5rem 0 1rem;">Progreso en Juegos</h3>
              <div id="games-progress-list" class="table-container">
                <!-- Loaded dynamically -->
              </div>

              <!-- Interaction & Activity Log -->
              <h3 style="margin: 1.5rem 0 1rem;">Actividad e Interacciones</h3>
              <div id="recent-activity-list" class="table-container">
                <!-- Loaded dynamically -->
              </div>

              <!-- Monthly Summary -->
              <h3 style="margin: 1.5rem 0 1rem;">Resumen Mensual</h3>
              <div id="monthly-summary-container" style="background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 1rem;">
                <div id="monthly-summary-content">
                  <!-- Monthly summary rendered dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Rooms Tab -->
      <div id="tab-rooms" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Salas Grupales de Videollamada</h2>
            <button class="btn btn-primary" onclick="showCreateRoomModal()">+ Crear Sala</button>
          </div>
          <div class="card-body">
            <div class="alert alert-info" style="margin-bottom: 1.5rem;">
              Cree y gestione salas de videollamada para consultas grupales, clases, talleres y sesiones terapeuticas.
              Las salas usan tecnologia Jitsi Meet (gratuita y segura).
            </div>

            <div class="rooms-grid" id="rooms-list">
              <!-- Default Rooms -->
              <div class="room-card">
                <div class="room-header">
                  <span class="room-icon">üë•</span>
                  <span class="room-status status-badge status-active">Disponible</span>
                </div>
                <h3>Consulta Grupal</h3>
                <p>Sala principal para consultas grupales con pacientes del HDD.</p>
                <div class="room-info">
                  <span>Capacidad: 20 participantes</span>
                </div>
                <div class="room-actions">
                  <button class="btn btn-primary" onclick="joinRoom('hdd-consulta-grupal')">Iniciar Sala</button>
                  <button class="btn btn-secondary" onclick="copyRoomLink('hdd-consulta-grupal')">Copiar Link</button>
                </div>
              </div>

              <div class="room-card">
                <div class="room-header">
                  <span class="room-icon">üéì</span>
                  <span class="room-status status-badge status-active">Disponible</span>
                </div>
                <h3>Aula Virtual</h3>
                <p>Sala para clases, talleres educativos y presentaciones.</p>
                <div class="room-info">
                  <span>Capacidad: 30 participantes</span>
                </div>
                <div class="room-actions">
                  <button class="btn btn-primary" onclick="joinRoom('hdd-aula-virtual')">Iniciar Sala</button>
                  <button class="btn btn-secondary" onclick="copyRoomLink('hdd-aula-virtual')">Copiar Link</button>
                </div>
              </div>

              <div class="room-card">
                <div class="room-header">
                  <span class="room-icon">üßò</span>
                  <span class="room-status status-badge status-active">Disponible</span>
                </div>
                <h3>Terapia Grupal</h3>
                <p>Sala para sesiones de terapia grupal y mindfulness.</p>
                <div class="room-info">
                  <span>Capacidad: 15 participantes</span>
                </div>
                <div class="room-actions">
                  <button class="btn btn-primary" onclick="joinRoom('hdd-terapia-grupal')">Iniciar Sala</button>
                  <button class="btn btn-secondary" onclick="copyRoomLink('hdd-terapia-grupal')">Copiar Link</button>
                </div>
              </div>

              <div class="room-card">
                <div class="room-header">
                  <span class="room-icon">üé¨</span>
                  <span class="room-status status-badge status-active">Disponible</span>
                </div>
                <h3>Sala Multimedia</h3>
                <p>Para compartir videos, peliculas y contenido multimedia.</p>
                <div class="room-info">
                  <span>Capacidad: 25 participantes</span>
                </div>
                <div class="room-actions">
                  <button class="btn btn-primary" onclick="joinRoom('hdd-multimedia')">Iniciar Sala</button>
                  <button class="btn btn-secondary" onclick="copyRoomLink('hdd-multimedia')">Copiar Link</button>
                </div>
              </div>
            </div>

            <!-- Custom Rooms -->
            <h3 style="margin: 2rem 0 1rem;">Salas Personalizadas</h3>
            <div id="custom-rooms-list" class="rooms-grid">
              <div class="empty-state">
                <div class="empty-state-icon">üìπ</div>
                <p>No hay salas personalizadas creadas</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resources Tab -->
      <div id="tab-resources" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Recursos y Cursos</h2>
            <button class="btn btn-primary" onclick="showAddResourceModal()">+ Agregar Recurso</button>
          </div>
          <div class="card-body">
            <div class="alert alert-info" style="margin-bottom: 1.5rem;">
              Biblioteca de recursos educativos, videos, cursos y material de apoyo para pacientes y profesionales.
            </div>

            <!-- Resource Categories -->
            <div class="resources-categories">
              <button class="category-btn active" onclick="filterResources('all')">Todos</button>
              <button class="category-btn" onclick="filterResources('video')">Videos</button>
              <button class="category-btn" onclick="filterResources('document')">Documentos</button>
              <button class="category-btn" onclick="filterResources('course')">Cursos</button>
              <button class="category-btn" onclick="filterResources('link')">Enlaces</button>
            </div>

            <div class="resources-grid" id="resources-list">
              <!-- Sample Resources -->
              <div class="resource-card" data-category="video">
                <div class="resource-icon">üé•</div>
                <div class="resource-content">
                  <h4>Tecnicas de Relajacion</h4>
                  <p>Video introductorio sobre tecnicas de respiracion y relajacion muscular progresiva.</p>
                  <div class="resource-meta">
                    <span class="resource-type">Video</span>
                    <span>Duracion: 15 min</span>
                  </div>
                </div>
                <div class="resource-actions">
                  <button class="btn btn-primary btn-sm" onclick="openResource('video', 'https://www.youtube.com/embed/dQw4w9WgXcQ')">Ver</button>
                </div>
              </div>

              <div class="resource-card" data-category="document">
                <div class="resource-icon">üìÑ</div>
                <div class="resource-content">
                  <h4>Guia de Medicacion</h4>
                  <p>Documento sobre manejo responsable de medicacion psiquiatrica.</p>
                  <div class="resource-meta">
                    <span class="resource-type">PDF</span>
                    <span>10 paginas</span>
                  </div>
                </div>
                <div class="resource-actions">
                  <button class="btn btn-primary btn-sm" onclick="openResource('document', '#')">Descargar</button>
                </div>
              </div>

              <div class="resource-card" data-category="course">
                <div class="resource-icon">üéì</div>
                <div class="resource-content">
                  <h4>Curso: Habilidades Sociales</h4>
                  <p>Curso de 4 modulos sobre desarrollo de habilidades sociales y comunicacion asertiva.</p>
                  <div class="resource-meta">
                    <span class="resource-type">Curso</span>
                    <span>4 modulos</span>
                  </div>
                </div>
                <div class="resource-actions">
                  <button class="btn btn-primary btn-sm" onclick="openResource('course', '#')">Acceder</button>
                </div>
              </div>

              <div class="resource-card" data-category="video">
                <div class="resource-icon">üé•</div>
                <div class="resource-content">
                  <h4>Mindfulness para Principiantes</h4>
                  <p>Sesion guiada de meditacion mindfulness para principiantes.</p>
                  <div class="resource-meta">
                    <span class="resource-type">Video</span>
                    <span>Duracion: 20 min</span>
                  </div>
                </div>
                <div class="resource-actions">
                  <button class="btn btn-primary btn-sm" onclick="openResource('video', '#')">Ver</button>
                </div>
              </div>

              <div class="resource-card" data-category="link">
                <div class="resource-icon">üîó</div>
                <div class="resource-content">
                  <h4>Portal de Salud Mental</h4>
                  <p>Enlace al portal nacional de recursos de salud mental.</p>
                  <div class="resource-meta">
                    <span class="resource-type">Enlace</span>
                  </div>
                </div>
                <div class="resource-actions">
                  <button class="btn btn-primary btn-sm" onclick="openResource('link', 'https://www.argentina.gob.ar/salud/mental')">Visitar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activities Tab -->
      <div id="tab-activities" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Actividades Semanales</h2>
          </div>
          <div class="card-body">
            <div id="activities-list">
              <div class="empty-state">Cargando actividades...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports Tab -->
      <div id="tab-reports" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2>Reportes y Estadisticas</h2>
          </div>
          <div class="card-body">
            <div class="alert alert-info">
              Los reportes detallados estaran disponibles proximamente. Actualmente puede ver las estadisticas generales en la parte superior.
            </div>

            <h3 style="margin-bottom: 1rem;">Resumen de Actividad</h3>
            <div class="patient-detail" id="activity-summary">
              <div class="detail-item">
                <div class="detail-label">Total Pacientes Registrados</div>
                <div class="detail-value" id="report-total">-</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Con Contrasena Configurada</div>
                <div class="detail-value" id="report-password">-</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Ultimo Login</div>
                <div class="detail-value" id="report-last-login">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Patient Modal -->
  <div id="add-patient-modal" class="modal-overlay hidden" onclick="closeModal(event, 'add-patient-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Agregar Nuevo Paciente</h3>
        <button class="modal-close" onclick="hideModal('add-patient-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-patient-form">
          <div class="form-group">
            <label for="new-dni">DNI *</label>
            <input type="text" id="new-dni" placeholder="Sin puntos" required>
          </div>
          <div class="form-group">
            <label for="new-name">Nombre Completo *</label>
            <input type="text" id="new-name" placeholder="Apellido, Nombre" required>
          </div>
          <div class="form-group">
            <label for="new-email">Email</label>
            <input type="email" id="new-email" placeholder="email@ejemplo.com">
          </div>
          <div class="form-group">
            <label for="new-phone">Telefono</label>
            <input type="tel" id="new-phone" placeholder="+54 11 1234-5678">
          </div>
          <div class="form-group">
            <label for="new-admission">Fecha de Ingreso *</label>
            <input type="date" id="new-admission" required>
          </div>
          <div class="form-group">
            <label for="new-notes">Notas</label>
            <textarea id="new-notes" rows="3" placeholder="Observaciones adicionales..."></textarea>
          </div>
          <div id="add-patient-error" class="form-error hidden"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('add-patient-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="addPatient()">Agregar Paciente</button>
      </div>
    </div>
  </div>

  <!-- Patient Detail Modal -->
  <div id="patient-detail-modal" class="modal-overlay hidden" onclick="closeModal(event, 'patient-detail-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Detalle del Paciente</h3>
        <button class="modal-close" onclick="hideModal('patient-detail-modal')">&times;</button>
      </div>
      <div class="modal-body" id="patient-detail-content">
        <!-- Content loaded dynamically -->
      </div>
      <div class="modal-footer" id="patient-detail-actions">
        <!-- Actions loaded dynamically -->
      </div>
    </div>
  </div>

  <!-- Edit Patient Modal -->
  <div id="edit-patient-modal" class="modal-overlay hidden" onclick="closeModal(event, 'edit-patient-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Editar Paciente</h3>
        <button class="modal-close" onclick="hideModal('edit-patient-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="edit-patient-form">
          <input type="hidden" id="edit-patient-id">
          <div class="form-group">
            <label for="edit-name">Nombre Completo *</label>
            <input type="text" id="edit-name" required>
          </div>
          <div class="form-group">
            <label for="edit-email">Email</label>
            <input type="email" id="edit-email">
          </div>
          <div class="form-group">
            <label for="edit-phone">Telefono</label>
            <input type="tel" id="edit-phone">
          </div>
          <div class="form-group">
            <label for="edit-notes">Notas</label>
            <textarea id="edit-notes" rows="3"></textarea>
          </div>
          <div id="edit-patient-error" class="form-error hidden"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('edit-patient-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="savePatient()">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Create Room Modal -->
  <div id="create-room-modal" class="modal-overlay hidden" onclick="closeModal(event, 'create-room-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Crear Sala de Videollamada</h3>
        <button class="modal-close" onclick="hideModal('create-room-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="create-room-form">
          <div class="form-group">
            <label for="room-name">Nombre de la Sala *</label>
            <input type="text" id="room-name" placeholder="Ej: Sesion Familiar Grupo A" required>
          </div>
          <div class="form-group">
            <label for="room-desc">Descripcion</label>
            <textarea id="room-desc" rows="2" placeholder="Descripcion breve de la sala..."></textarea>
          </div>
          <div class="form-group">
            <label for="room-icon">Icono</label>
            <select id="room-icon">
              <option value="üë•">üë• Grupo</option>
              <option value="üéì">üéì Educacion</option>
              <option value="üßò">üßò Terapia</option>
              <option value="üé¨">üé¨ Multimedia</option>
              <option value="üí¨">üí¨ Charla</option>
              <option value="üè•">üè• Clinica</option>
              <option value="üë®‚Äçüë©‚Äçüëß‚Äçüë¶">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familia</option>
            </select>
          </div>
          <div class="form-hint">La sala se creara con un enlace unico de Jitsi Meet.</div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('create-room-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="createRoom()">Crear Sala</button>
      </div>
    </div>
  </div>

  <!-- Add Resource Modal -->
  <div id="add-resource-modal" class="modal-overlay hidden" onclick="closeModal(event, 'add-resource-modal')">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Agregar Recurso</h3>
        <button class="modal-close" onclick="hideModal('add-resource-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-resource-form">
          <div class="form-group">
            <label for="resource-title">Titulo *</label>
            <input type="text" id="resource-title" required>
          </div>
          <div class="form-group">
            <label for="resource-type">Tipo *</label>
            <select id="resource-type" required>
              <option value="video">Video</option>
              <option value="document">Documento</option>
              <option value="course">Curso</option>
              <option value="link">Enlace</option>
            </select>
          </div>
          <div class="form-group">
            <label for="resource-url">URL *</label>
            <input type="url" id="resource-url" placeholder="https://..." required>
          </div>
          <div class="form-group">
            <label for="resource-description">Descripcion</label>
            <textarea id="resource-description" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('add-resource-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="addResource()">Agregar</button>
      </div>
    </div>
  </div>

  <!-- Video Player Modal -->
  <div id="video-modal" class="video-modal hidden" onclick="closeVideoModal()">
    <div class="video-modal-content" onclick="event.stopPropagation()">
      <button class="video-modal-close" onclick="closeVideoModal()">&times;</button>
      <iframe id="video-iframe" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>

  <!-- Jitsi Room Container -->
  <div id="jitsi-container" class="jitsi-container hidden">
    <button class="jitsi-close" onclick="closeJitsi()">Salir de la Sala</button>
    <iframe id="jitsi-iframe" src="" allow="camera; microphone; fullscreen; display-capture"></iframe>
  </div>


  <script src="/js/hdd-admin.js" defer></script>
</body>
</html>
